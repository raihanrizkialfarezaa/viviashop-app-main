<!DOCTYPE html>
<html>
    <head>
        <title>Test Checkout Total Update</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <meta name="csrf-token" content="test-token" />
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
                max-width: 800px;
                margin: 0 auto;
            }
            .section {
                margin: 20px 0;
                padding: 20px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
            }
            .total-section {
                background: #f7fafc;
                border-color: #4299e1;
            }
            .total-amount {
                font-size: 24px;
                font-weight: bold;
                color: #2d3748;
            }
            select,
            input {
                margin: 8px;
                padding: 8px;
                border: 1px solid #cbd5e0;
                border-radius: 4px;
            }
            button {
                background: #4299e1;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
            }
            button:hover {
                background: #3182ce;
            }
            .log {
                background: #1a202c;
                color: #e2e8f0;
                padding: 15px;
                margin: 10px 0;
                border-radius: 4px;
                font-family: monospace;
                font-size: 12px;
                max-height: 300px;
                overflow-y: auto;
            }
            .delivery-method {
                margin: 10px 0;
            }
            input[type="radio"] {
                margin-right: 8px;
            }
            label {
                margin-right: 20px;
            }
            .warning {
                background: #fed7d7;
                border: 1px solid #fc8181;
                padding: 10px;
                border-radius: 4px;
                color: #c53030;
            }
        </style>
    </head>
    <body>
        <h1>üõí Test Checkout Total Calculation</h1>

        <div class="warning">
            <strong>‚ö†Ô∏è Test Environment:</strong> This simulates the checkout
            page total calculation functionality.
        </div>

        <div class="section total-section">
            <h3>üí∞ Order Summary</h3>
            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    margin: 10px 0;
                "
            >
                <span>Subtotal:</span>
                <span>Rp. 150,000</span>
            </div>
            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    margin: 10px 0;
                "
            >
                <span>Unique Code:</span>
                <span
                    >Rp.
                    <input
                        type="number"
                        class="unique_code"
                        value="123"
                        min="0"
                        style="width: 80px"
                /></span>
            </div>
            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    margin: 10px 0;
                "
            >
                <span>Shipping Cost:</span>
                <span>Rp. <span id="shipping-display">0</span></span>
            </div>
            <hr />
            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    margin: 15px 0;
                "
            >
                <span style="font-size: 18px; font-weight: bold">TOTAL:</span>
                <span class="total-amount">150,123</span>
            </div>
            <p style="color: #718096; font-size: 14px">
                harap tunggu nominal berubah sesuai dengan total sebelum
                checkout
            </p>

            <!-- Test buttons like in real checkout -->
            <div style="margin-top: 15px">
                <button type="button" id="test-update-total">
                    üîÑ Test Update Total
                </button>
                <button type="button" id="show-debug">üêõ Show Debug</button>
                <button type="button" id="clear-log">üóëÔ∏è Clear Log</button>
            </div>
        </div>

        <div class="section">
            <h3>üöö Delivery Method</h3>
            <div class="delivery-method">
                <input
                    type="radio"
                    name="delivery_method"
                    value="self"
                    id="self"
                />
                <label for="self">Self Pickup (Free)</label>
            </div>
            <div class="delivery-method">
                <input
                    type="radio"
                    name="delivery_method"
                    value="courier"
                    id="courier"
                    checked
                />
                <label for="courier">Courier Delivery</label>
            </div>
        </div>

        <div class="section" id="shipping-row">
            <h3>üì¶ Shipping Options</h3>
            <select
                id="shipping-cost-option"
                style="width: 100%; max-width: 400px"
            >
                <option value="">-- Select Shipping Service --</option>
                <option
                    value='{"service":"Regular","cost":"15000","etd":"2-3 days","courier":"JNE"}'
                >
                    JNE Regular - Rp. 15,000 (2-3 days)
                </option>
                <option
                    value='{"service":"YES","cost":"25000","etd":"1-2 days","courier":"JNE"}'
                >
                    JNE YES - Rp. 25,000 (1-2 days)
                </option>
                <option
                    value='{"service":"REG","cost":"12000","etd":"3-4 days","courier":"POS"}'
                >
                    POS REG - Rp. 12,000 (3-4 days)
                </option>
                <option
                    value='{"service":"Express","cost":"35000","etd":"1 day","courier":"TIKI"}'
                >
                    TIKI Express - Rp. 35,000 (1 day)
                </option>
            </select>
        </div>

        <div class="section">
            <h3>üñ•Ô∏è Console Log</h3>
            <div id="console-log" class="log">
                Console messages will appear here...
            </div>
        </div>

        <script>
            // Override console.log to display in HTML
            const originalLog = console.log;
            const originalError = console.error;
            console.log = function (...args) {
                originalLog.apply(console, args);
                const logDiv = document.getElementById("console-log");
                const message = args
                    .map((arg) =>
                        typeof arg === "object"
                            ? JSON.stringify(arg, null, 2)
                            : String(arg)
                    )
                    .join(" ");
                logDiv.innerHTML +=
                    '<div style="color: #90cdf4;">' +
                    new Date().toLocaleTimeString() +
                    ": " +
                    message +
                    "</div>";
                logDiv.scrollTop = logDiv.scrollHeight;
            };

            console.error = function (...args) {
                originalError.apply(console, args);
                const logDiv = document.getElementById("console-log");
                const message = args
                    .map((arg) =>
                        typeof arg === "object"
                            ? JSON.stringify(arg, null, 2)
                            : String(arg)
                    )
                    .join(" ");
                logDiv.innerHTML +=
                    '<div style="color: #fc8181;">‚ùå ' +
                    new Date().toLocaleTimeString() +
                    ": " +
                    message +
                    "</div>";
                logDiv.scrollTop = logDiv.scrollHeight;
            };

            function number_format(number) {
                return new Intl.NumberFormat("id-ID").format(number);
            }

            function updateTotalAmount() {
                var subtotal = 150000; // Fixed value for testing
                var uniqueCode = parseInt($(".unique_code").val()) || 0;
                var shippingCost = 0;

                var deliveryMethod = $(
                    'input[name="delivery_method"]:checked'
                ).val();

                console.log(
                    "üîÑ Updating total - Delivery method:",
                    deliveryMethod
                );
                console.log("Subtotal:", subtotal);
                console.log("Unique code:", uniqueCode);

                if (deliveryMethod === "self") {
                    shippingCost = 0;
                    console.log("Self pickup - Shipping cost: 0");
                } else if (deliveryMethod === "courier") {
                    var selectedShipping = $("#shipping-cost-option").val();
                    console.log("Selected shipping value:", selectedShipping);

                    if (selectedShipping) {
                        try {
                            var shippingData = JSON.parse(selectedShipping);
                            shippingCost = parseInt(shippingData.cost) || 0;
                            console.log(
                                "‚úÖ Parsed shipping cost:",
                                shippingCost
                            );
                            console.log("üìä Shipping data:", shippingData);
                        } catch (e) {
                            console.error("Error parsing shipping data:", e);
                            console.log(
                                "Raw shipping value:",
                                selectedShipping
                            );
                        }
                    } else {
                        console.log("‚ÑπÔ∏è No shipping option selected");
                    }
                }

                var total = subtotal + uniqueCode + shippingCost;
                console.log(
                    "üßÆ Final total calculation:",
                    subtotal,
                    "+",
                    uniqueCode,
                    "+",
                    shippingCost,
                    "=",
                    total
                );

                $(".total-amount").text(number_format(total));
                $("#shipping-display").text(number_format(shippingCost));
                console.log("‚ú® Total updated to:", number_format(total));
            }

            $(document).ready(function () {
                console.log("üìÑ Page loaded, initializing...");

                // Setup CSRF token (simulate real checkout)
                $.ajaxSetup({
                    headers: {
                        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr(
                            "content"
                        ),
                    },
                });

                // Initialize total calculation
                updateTotalAmount();

                // Ensure a delivery method is selected by default if none is selected
                if ($('input[name="delivery_method"]:checked').length === 0) {
                    console.log(
                        "No delivery method selected, defaulting to courier"
                    );
                    $('input[name="delivery_method"][value="courier"]').prop(
                        "checked",
                        true
                    );
                    $("#shipping-row").show();
                    updateTotalAmount();
                }

                // Debug: Test element accessibility
                console.log("=== CHECKOUT PAGE DEBUG ===");
                console.log(
                    "Total amount element exists:",
                    $(".total-amount").length > 0
                );
                console.log(
                    "Total amount current text:",
                    $(".total-amount").text()
                );
                console.log(
                    "Unique code element exists:",
                    $(".unique_code").length > 0
                );
                console.log("Unique code value:", $(".unique_code").val());
                console.log(
                    "Shipping cost option element exists:",
                    $("#shipping-cost-option").length > 0
                );
                console.log(
                    "Delivery method elements count:",
                    $('input[name="delivery_method"]').length
                );
                console.log(
                    "Currently selected delivery method:",
                    $('input[name="delivery_method"]:checked').val()
                );
                console.log("============================");

                // EVENT HANDLERS

                $("#shipping-cost-option").on("change", function () {
                    console.log("üö¢ SHIPPING COST CHANGED!");
                    console.log("New value:", $(this).val());
                    updateTotalAmount();
                });

                $('input[name="delivery_method"]').on("change", function () {
                    var method = $(this).val();
                    console.log("üöö DELIVERY METHOD CHANGED to:", method);

                    if (method === "self") {
                        $("#shipping-row").hide();
                        updateTotalAmount();
                    } else if (method === "courier") {
                        $("#shipping-row").show();
                        updateTotalAmount();
                    }
                });

                $(".unique_code").on("input", function () {
                    console.log("üí∞ Unique code changed to:", $(this).val());
                    updateTotalAmount();
                });

                // TEST BUTTONS
                $("#test-update-total").on("click", function () {
                    console.log("üß™ MANUAL TOTAL UPDATE TEST");
                    updateTotalAmount();
                });

                $("#show-debug").on("click", function () {
                    console.log("üêõ CURRENT STATE DEBUG:");
                    console.log("Subtotal (fixed):", 150000);
                    console.log(
                        "Unique code element value:",
                        $(".unique_code").val()
                    );
                    console.log(
                        "Selected delivery method:",
                        $('input[name="delivery_method"]:checked').val()
                    );
                    console.log(
                        "Selected shipping option:",
                        $("#shipping-cost-option").val()
                    );
                    console.log(
                        "Current total text:",
                        $(".total-amount").text()
                    );

                    // Test if elements are accessible
                    console.log("Element tests:");
                    console.log(
                        "- .total-amount exists:",
                        $(".total-amount").length
                    );
                    console.log(
                        "- .unique_code exists:",
                        $(".unique_code").length
                    );
                    console.log(
                        "- #shipping-cost-option exists:",
                        $("#shipping-cost-option").length
                    );
                    console.log(
                        "- delivery_method radio buttons:",
                        $('input[name="delivery_method"]').length
                    );
                });

                $("#clear-log").on("click", function () {
                    $("#console-log").html(
                        "Console messages will appear here..."
                    );
                });

                // Initial setup
                if (
                    $('input[name="delivery_method"]:checked').val() === "self"
                ) {
                    $("#shipping-row").hide();
                }
            });
        </script>
    </body>
</html>
