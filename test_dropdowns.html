<!DOCTYPE html>
<html>
    <head>
        <title>Test API Endpoints</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
    <body>
        <h1>Testing Address Dropdowns</h1>

        <div>
            <label>Province:</label>
            <select id="province">
                <option value="">Loading...</option>
            </select>
        </div>

        <div>
            <label>City:</label>
            <select id="city">
                <option value="">Select Province First</option>
            </select>
        </div>

        <div>
            <label>District:</label>
            <select id="district">
                <option value="">Select City First</option>
            </select>
        </div>

        <div id="log"></div>

        <script>
            function log(message) {
                $("#log").append(
                    "<div>" +
                        new Date().toLocaleTimeString() +
                        ": " +
                        message +
                        "</div>"
                );
            }

            $(document).ready(function () {
                log("Loading provinces...");

                // Load provinces
                $.ajax({
                    url: "http://127.0.0.1:8000/api/provinces",
                    type: "GET",
                    success: function (response) {
                        log("Provinces loaded: " + response.length + " items");
                        var options =
                            '<option value="">-- Select Province --</option>';
                        if (response && Array.isArray(response)) {
                            $.each(response, function (index, province) {
                                var selected =
                                    province.id == 18 ? "selected" : "";
                                options +=
                                    '<option value="' +
                                    province.id +
                                    '" ' +
                                    selected +
                                    ">" +
                                    province.name +
                                    "</option>";
                            });
                        }
                        $("#province").html(options);

                        // Auto-select Jawa Timur (18) and load cities
                        $("#province").val(18).trigger("change");
                    },
                    error: function (xhr, status, error) {
                        log("Error loading provinces: " + error);
                    },
                });

                // Province change event
                $("#province").on("change", function () {
                    var province_id = $(this).val();
                    log("Province changed to: " + province_id);

                    if (province_id) {
                        $.ajax({
                            url:
                                "http://127.0.0.1:8000/api/cities/" +
                                province_id,
                            type: "GET",
                            success: function (response) {
                                log(
                                    "Cities loaded: " +
                                        response.length +
                                        " items"
                                );
                                var options =
                                    '<option value="">-- Select City --</option>';
                                if (response && Array.isArray(response)) {
                                    $.each(response, function (index, city) {
                                        var selected =
                                            city.id == 388 ? "selected" : "";
                                        options +=
                                            '<option value="' +
                                            city.id +
                                            '" ' +
                                            selected +
                                            ">" +
                                            city.name +
                                            "</option>";
                                    });
                                }
                                $("#city").html(options);

                                // Auto-select Mojokerto (388) and load districts
                                $("#city").val(388).trigger("change");
                            },
                            error: function (xhr, status, error) {
                                log("Error loading cities: " + error);
                            },
                        });
                    }
                });

                // City change event
                $("#city").on("change", function () {
                    var city_id = $(this).val();
                    log("City changed to: " + city_id);

                    if (city_id) {
                        $.ajax({
                            url:
                                "http://127.0.0.1:8000/api/districts/" +
                                city_id,
                            type: "GET",
                            success: function (response) {
                                log(
                                    "Districts loaded: " +
                                        response.length +
                                        " items"
                                );
                                var options =
                                    '<option value="">-- Select District --</option>';
                                if (response && Array.isArray(response)) {
                                    $.each(
                                        response,
                                        function (index, district) {
                                            options +=
                                                '<option value="' +
                                                district.id +
                                                '">' +
                                                district.name +
                                                "</option>";
                                        }
                                    );
                                }
                                $("#district").html(options);
                            },
                            error: function (xhr, status, error) {
                                log("Error loading districts: " + error);
                            },
                        });
                    }
                });
            });
        </script>
    </body>
</html>
