<!DOCTYPE html>
<html>
    <head>
        <title>Test Total Calculation</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
            }
            .section {
                margin: 20px 0;
                padding: 15px;
                border: 1px solid #ddd;
            }
            select,
            input {
                margin: 5px;
                padding: 5px;
            }
            .total {
                font-size: 18px;
                font-weight: bold;
                color: #2c5282;
            }
            .log {
                background: #f7fafc;
                padding: 10px;
                margin: 10px 0;
                border-left: 4px solid #4299e1;
            }
        </style>
    </head>
    <body>
        <h1>Test Checkout Total Calculation</h1>

        <div class="section">
            <h3>Order Summary</h3>
            <p>Subtotal: Rp. <span id="subtotal">150000</span></p>
            <p>
                Unique Code: Rp.
                <input type="number" class="unique_code" value="123" min="0" />
            </p>
            <p>Shipping Cost: Rp. <span id="shipping-display">0</span></p>
            <hr />
            <p class="total">
                Total: Rp. <span class="total-amount">150123</span>
            </p>
        </div>

        <div class="section">
            <h3>Delivery Method</h3>
            <input type="radio" name="delivery_method" value="self" id="self" />
            <label for="self">Self Pickup (Free)</label><br />
            <input
                type="radio"
                name="delivery_method"
                value="courier"
                id="courier"
                checked
            />
            <label for="courier">Courier Delivery</label>
        </div>

        <div class="section" id="shipping-section">
            <h3>Shipping Options</h3>
            <select id="shipping-cost-option">
                <option value="">-- Select Shipping Service --</option>
                <option
                    value='{"service":"Regular","cost":"15000","etd":"2-3 days","courier":"JNE"}'
                >
                    JNE Regular - Rp. 15,000 (2-3 days)
                </option>
                <option
                    value='{"service":"YES","cost":"25000","etd":"1-2 days","courier":"JNE"}'
                >
                    JNE YES - Rp. 25,000 (1-2 days)
                </option>
                <option
                    value='{"service":"REG","cost":"12000","etd":"3-4 days","courier":"POS"}'
                >
                    POS REG - Rp. 12,000 (3-4 days)
                </option>
            </select>
        </div>

        <div class="section">
            <h3>Console Log</h3>
            <div id="console-log" class="log">
                <!-- Console messages will appear here -->
            </div>
        </div>

        <script>
            // Override console.log to display in HTML
            const originalLog = console.log;
            console.log = function (...args) {
                originalLog.apply(console, args);
                const logDiv = document.getElementById("console-log");
                const message = args
                    .map((arg) =>
                        typeof arg === "object"
                            ? JSON.stringify(arg)
                            : String(arg)
                    )
                    .join(" ");
                logDiv.innerHTML +=
                    "<div>" +
                    new Date().toLocaleTimeString() +
                    ": " +
                    message +
                    "</div>";
                logDiv.scrollTop = logDiv.scrollHeight;
            };

            function number_format(number) {
                return new Intl.NumberFormat("id-ID").format(number);
            }

            function updateTotalAmount() {
                var subtotal = parseInt(
                    document.getElementById("subtotal").textContent
                );
                var uniqueCode = parseInt($(".unique_code").val()) || 0;
                var shippingCost = 0;

                var deliveryMethod = $(
                    'input[name="delivery_method"]:checked'
                ).val();

                console.log(
                    "Updating total - Delivery method:",
                    deliveryMethod
                );
                console.log("Subtotal:", subtotal);
                console.log("Unique code:", uniqueCode);

                if (deliveryMethod === "self") {
                    shippingCost = 0;
                    console.log("Self pickup - Shipping cost: 0");
                } else if (deliveryMethod === "courier") {
                    var selectedShipping = $("#shipping-cost-option").val();
                    console.log("Selected shipping value:", selectedShipping);

                    if (selectedShipping) {
                        try {
                            var shippingData = JSON.parse(selectedShipping);
                            shippingCost = parseInt(shippingData.cost) || 0;
                            console.log("Parsed shipping cost:", shippingCost);
                            console.log("Shipping data:", shippingData);
                        } catch (e) {
                            console.error("Error parsing shipping data:", e);
                            console.log(
                                "Raw shipping value:",
                                selectedShipping
                            );
                        }
                    } else {
                        console.log("No shipping option selected");
                    }
                }

                var total = subtotal + uniqueCode + shippingCost;
                console.log(
                    "Final total calculation:",
                    subtotal,
                    "+",
                    uniqueCode,
                    "+",
                    shippingCost,
                    "=",
                    total
                );

                $(".total-amount").text(number_format(total));
                $("#shipping-display").text(number_format(shippingCost));
                console.log("Total updated to:", number_format(total));
            }

            $(document).ready(function () {
                console.log("Page loaded, initializing...");

                // Initialize total calculation
                updateTotalAmount();

                // Event handlers
                $("#shipping-cost-option").on("change", function () {
                    console.log("Shipping option changed");
                    updateTotalAmount();
                });

                $('input[name="delivery_method"]').on("change", function () {
                    console.log("Delivery method changed to:", $(this).val());

                    if ($(this).val() === "self") {
                        $("#shipping-section").hide();
                    } else {
                        $("#shipping-section").show();
                    }

                    updateTotalAmount();
                });

                $(".unique_code").on("input", function () {
                    console.log("Unique code changed to:", $(this).val());
                    updateTotalAmount();
                });

                // Initial setup
                if (
                    $('input[name="delivery_method"]:checked').val() === "self"
                ) {
                    $("#shipping-section").hide();
                }
            });
        </script>
    </body>
</html>
